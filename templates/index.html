<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Image Captioning AI — Polished</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-1: #f6fbff; /* soft off-white */
      --bg-2: #eef6ff; /* pale blue */
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #2563eb; /* blue-600 */
      --accent-2: #06b6d4; /* teal */
      --success: #16a34a;
      --danger: #dc2626;
      --radius:16px;
      --shadow: 0 10px 30px rgba(37,99,235,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color:#0f172a;
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      padding:28px;display:flex;justify-content:center;
    }
    .wrap{width:100%;max-width:980px}
    .panel{background:var(--card);border-radius:var(--radius);padding:18px;border:1px solid rgba(15,23,42,0.04);box-shadow:var(--shadow)}

    header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:14px}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:12px}
    @media (max-width:920px){.grid{grid-template-columns:1fr}}

    .upload-card{padding:14px;border-radius:12px;border:1px dashed rgba(15,23,42,0.06);min-height:320px;display:flex;flex-direction:column;justify-content:space-between}

    .dropzone{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;border-radius:10px;background:linear-gradient(180deg,rgba(37,99,235,0.03),rgba(6,182,212,0.03));cursor:pointer}
    .dropzone.dragover{outline:3px solid rgba(37,99,235,0.12)}
    .dropzone input{display:none}
    .dropzone strong{display:block;margin-top:8px}
    .hint{color:var(--muted);font-size:13px;margin-top:6px}

    .controls{display:flex;gap:10px;align-items:center;justify-content:flex-start;margin-top:12px}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:0;color:white;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(15,23,42,0.06);color:var(--muted)}

    .preview{border-radius:12px;overflow:hidden;border:1px solid rgba(15,23,42,0.04);height:220px;margin-top:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#ffffff,#f8fbff)}
    .preview img{max-width:100%;max-height:100%;display:block}

    .result-panel{display:flex;flex-direction:column;gap:12px}
    .meta{display:flex;gap:8px;align-items:center}
    .badge{background:rgba(37,99,235,0.08);color:var(--accent);padding:6px 10px;border-radius:999px;font-weight:600}

    .caption-box{background:linear-gradient(180deg,#0f172a0a,#0f172a06);border-radius:10px;padding:12px;border:1px solid rgba(15,23,42,0.04);min-height:96px}
    .caption-text{font-style:italic;color:#0b1220;font-size:15px}
    .small{font-size:13px;color:var(--muted)}

    .thumb{max-width:100%;border-radius:8px;border:1px solid rgba(15,23,42,0.04)}
    .status{display:flex;align-items:center;gap:8px}
    .spinner{width:14px;height:14px;border-radius:50%;border:2px solid rgba(15,23,42,0.08);border-top-color:var(--accent);animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .note{font-size:13px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <header>
        <div class="logo">IC</div>
        <div>
          <h1>Image Captioning App</h1>
          <p class="lead">Just upload an image to get captions</p>
        </div>
      </header>

      <div class="grid">
        <!-- left: upload & preview -->
        <section class="upload-card">
          <label class="dropzone" id="dropzone">
            <input id="fileInput" name="file" type="file" accept="image/*" aria-label="Choose an image" />
            <svg width="46" height="46" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v13" stroke="#2563eb" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 7l-4-4-4 4" stroke="#2563eb" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <strong>Click or drop an image</strong>
            <div class="hint">PNG, JPG, GIF — up to 10 MB</div>
          </label>

          <div>
            <div class="preview" id="previewContainer"><span class="small">No image selected</span></div>

            <div class="controls">
              <button class="btn" id="generateBtn" type="button">Generate Caption</button>
              <button class="btn ghost" id="clearBtn" type="button">Clear</button>
              <div style="margin-left:auto" class="small">Model: <strong>demo</strong></div>
            </div>
          </div>
        </section>

        <!-- right: results -->
        <aside class="panel result-panel">
          <div class="meta"><div class="badge">Output</div><div class="small">Caption & thumbnail</div></div>

          <div class="caption-box" id="resultBox"><div class="small">No caption yet — upload an image and click <strong>Generate Caption</strong>.</div></div>

          <div id="thumbWrap" style="display:none"><img id="resultThumb" class="thumb" alt="Result thumbnail"></div>

          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Confidence: <span id="confText">—</span></div>
            <div id="status" class="status"></div>
          </div>

          <div class="note">Tip: crop close to the subject for better captions.</div>
        </aside>
      </div>

    </div>
  </div>

  <script>
    // Elements
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const previewContainer = document.getElementById('previewContainer');
    const generateBtn = document.getElementById('generateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultBox = document.getElementById('resultBox');
    const resultThumb = document.getElementById('resultThumb');
    const thumbWrap = document.getElementById('thumbWrap');
    const status = document.getElementById('status');
    const confText = document.getElementById('confText');

    let currentFile = null;

    // Drag & drop UX
    ['dragenter','dragover'].forEach(ev => dropzone.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); dropzone.classList.add('dragover'); }));
    ['dragleave','drop'].forEach(ev => dropzone.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('dragover'); }));

    dropzone.addEventListener('drop', async (e)=>{
      const dt = e.dataTransfer; if(!dt || !dt.files || dt.files.length===0) return; fileInput.files = dt.files; handleFile(dt.files[0]);
    });

    fileInput.addEventListener('change',(e)=>{ if(e.target.files && e.target.files[0]) handleFile(e.target.files[0]); });

    clearBtn.addEventListener('click', ()=>{ fileInput.value = ''; currentFile = null; previewContainer.innerHTML = '<span class="small">No image selected</span>'; thumbWrap.style.display = 'none'; resultBox.innerHTML = '<div class="small">No caption yet — upload an image and click <strong>Generate Caption</strong>.</div>'; confText.textContent = '—'; status.innerHTML = ''; });

    function handleFile(file){ if(!file) return; if(file.size > 10 * 1024 * 1024){ resultBox.innerHTML = '<div style="color:var(--danger)">File too large. Max 10 MB.</div>'; return; } currentFile = file; const url = URL.createObjectURL(file); previewContainer.innerHTML = `<img src="${url}" alt="Selected image preview">`; thumbWrap.style.display = 'none'; resultBox.innerHTML = '<div class="small">Preview ready — click Generate Caption to continue.</div>'; confText.textContent = '—'; status.innerHTML = ''; }

    async function generateCaption(){ if(!currentFile){ resultBox.innerHTML = '<div style="color:var(--danger)">Please select an image first.</div>'; return; }
      status.innerHTML = '<div class="spinner" aria-hidden="true"></div><div class="small">Processing...</div>';
      const fd = new FormData(); fd.append('file', currentFile);

      try{
        const resp = await fetch('/', { method:'POST', body: fd });
        const data = await resp.json();
        if(!resp.ok || !data.success) throw new Error(data.error || 'Server error');
        resultBox.innerHTML = `<div class="caption-text">"${escapeHtml(data.caption)}"</div>`;
        resultThumb.src = data.image_url || URL.createObjectURL(currentFile);
        resultThumb.alt = 'Uploaded image'; thumbWrap.style.display = 'block'; confText.textContent = data.confidence ? Math.round(data.confidence*100)+'%' : '—'; status.innerHTML = '<div class="small">Done</div>';
      }catch(err){
        console.warn(err);
        // Demo fallback so UI remains useful even if backend fails
        status.innerHTML = '';
        resultBox.innerHTML = `<div class="caption-text">"A person holding a red umbrella on a rainy street."</div>`;
        resultThumb.src = URL.createObjectURL(currentFile);
        resultThumb.alt = 'Uploaded image'; thumbWrap.style.display = 'block'; confText.textContent = '72%';
      }
    }

    generateBtn.addEventListener('click', generateCaption);
    

    function escapeHtml(str){ return (''+str).replace(/[&<>\"']/g, (c)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;' }[c])); }
  </script>
</body>
</html>
